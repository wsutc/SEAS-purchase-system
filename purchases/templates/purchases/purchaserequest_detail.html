{% extends 'purchases/detail_page.html' %}
{% block title %}Purchase Request {{ object.number }}{% endblock %}
{% block header %}Purchase Request{% endblock %}
{% block number %}{{ object.number }}{% endblock %}
{% block page %}

<div class="row mb-3">
    <div class="col-4">
        Created {{ object.created_date }}
    </div>
    <div class="col-12">
        <div class="bd-example-snippet bd-code-snippet">
            <div class="bd-example">
                <table class="table">
                    <tbody>
                        <tr>
                            <td style="width: 10em" align="right">Needed By</td>
                            <td style="width: 30em">
                                {% if object.need_by_date %}
                                    {{ object.need_by_date }}
                                {% else %}
                                    &nbsp;
                                {% endif %}
                            </td>
                            <td style="width: 10em" align="right">Requestor</td>
                            <td>{{ object.requisitioner }}</td>
                        </tr>
                        <tr>
                            <td align="right">Vendor</td>
                            <td><a href="{{ object.vendor.get_absolute_url }}">{{ object.vendor }}</a></td>
                            <td align="right">Email</td>
                            <td><a href="mailto:{{ object.requisitioner.email }}">{{ object.requisitioner.email }}</a></td>
                        </tr>
                        <tr>
                            <td align="right" rowspan=2>Address</td>
                            <td rowspan=2>{{ object.vendor.street1 }}<br>
                                {% if object.vendor.street2 %}
                                    {{ object.vendor.street2 }}<br>
                                {% endif %}
                                {% if object.vendor.city %}
                                    {{ object.vendor.city }}, {{ object.vendor.state.abbreviation }} {{ object.vendor.zip }}
                                {% else %}
                                {% endif %}
                            </td>
                            <td align="right">Phone</td>
                            <td>{{ object.requisitioner.phone }}</td>
                        </tr>
                        <tr>
                            <td align="right">Department</td>
                            <td>{{ object.requisitioner.department.code }}</td>
                        </tr>
                        <tr>
                            <td align="right">Phone</td>
                            <td>{{ object.vendor.phone }}</td>
                        </tr>
                        <tr>
                            <td align="right">Email</td>
                            {% if object.vendor.email %}
                                <td><a href="mailto:{{ object.vendor.email }}">{{ object.vendor.email }}</a></td>
                            {% else %}
                                <td></td>
                            {% endif %}
                        </tr>
                        <tr>
                            <td align="right">Website</td>
                            <td><a href="{{ object.vendor.website }}" target="_blank" rel="noopener noreferrer">{{ object.vendor.website }}<i class="fa-solid fa-up-right-from-square" data-fa-transform="shrink-6 up-4"></i></a></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    {% if debug %}<div>debug ->count:{{ object.accounts.count }}</div>{% endif %}
    <div class="col-12">
        <div class="h4">Budget</div>
        <div class="bd-example-snippet bd-code-snippet">
            <div class="bd-example">
                <table class="table table-striped">
                <thead>
                    <tr>
                        <th scope="col">Program</th>
                        <th scope="col">Gift</th>
                        <th scope="col">Grant</th>
                        <th scope="col">Spend Category</th>
                        <th scope="col">Dist (% or $)</th>
                    </tr>
                </thead>
                <tbody>
                    {% for b in object.accounts.all %}
                        <tr>
                            <td>{{ b.program_workday }}</td>
                            <td></td>
                            <td></td>
                            <td>{{ b.spend_category }}</td>
                            <td>{{ b.distribution_amount }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
                </table>
            </div>
        </div>
    </div>

    {% if debug %}<div>debug ->count:{{ object.items.count }}</div>{% endif %}
    <div class="col-12">
        <div class="bd-example-snippet bd-code-snippet">
            <div class="bd-example">
                <table class="table table-striped">
                <thead>
                    <tr>
                        <th class="text-center" style="width: 40%;">Description</th>
                        <th class="text-center" style="width:  5%;">Link</th>
                        <th class="text-center" style="width: 20%;">Identifier</th>
                        <th class="text-center" style="width:  5%;">QTY</th>
                        <th class="text-center" style="width: 10%;">Unit</th>
                        <th class="text-center" style="width: 10%;">Unit Price</th>
                        <th class="text-center" style="width: 10%;">Extended Price</th>
                    </tr>
                </thead>
                <tbody>
                    {{ object.items.all }}
                    {% for i in object.items.all %}
                        <tr>
                            <td class="text-truncate"><a href="{{ i.get_absolute_url }}">{{ i.description }}</a></td>
                            {% if i.link %}
                                <td style="text-align: center;"><a href="{{ i.link }}" target="_blank" rel="noopener noreferrer"><i class="fa-solid fa-up-right-from-square" ></i></a></td>
                            {% else %}
                                <td></td>
                            {% endif %}
                            <td align="center">{{ i.identifier }}</td>
                            {% for f in i.quantity.all %}<td align="center">{{ f }}</td>{% endfor %}
                            <td align="center">{{ i.unit }}</td>
                            <td align="right"></td>
                            <td align="right"></td>
                            <td align="right"></td>
                        </tr>
                    {% endfor %}
                </tbody>
                <tfoot>
                    <tr>
                        <td colspan="2">&nbsp;</td>
                        <td colspan="3" class="text-end">Subtotal</td>
                        <td align="right"></td>
                    </tr>
                    <tr>
                        <td colspan="2"></td>
                        <td colspan="3" class="text-end">Shipping</td>
                        <td align="right">{{ object.shipping }}</td>
                    </tr>
                    <tr>
                        <td colspan="2"></td>
                        <td colspan="3" class="text-end">Sales Tax</td>
                        <td align="right"></td>
                    </tr>
                    <tr>
                        <td colspan="2"></td>
                        <td colspan="3" class="text-end">Grand Total</td>
                        <td align="right"></td>
                    </tr>
                </tfoot>
                </table>
            </div>
        </div>
    </div>
    <div class="border">
        Why:
        {{ object.justification|linebreaks }}
    </div>
    <div><br></div>
    <div class="border">
        Special Instructions:
        {{ object.instruction|linebreaks }}
    </div>
</div>

{% endblock %}
